<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistant Culinaire - Kitchen Exchange</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"
        integrity="sha512-vc58qvvBdrDR4etbxMdlTt4GBQk1qjvyORR2nrsPsFPyrs+/u5c3+1Ct6upOgdZoIl7eq6k3a1UPDSNAQi/32A=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="main.css">
    <style>
        .chat-layout {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 24px;
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px 20px 80px;
            min-height: calc(100vh - 200px);
        }

        .chat-sidebar {
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            height: calc(100vh - 280px);
            position: sticky;
            top: 100px;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 2px solid var(--bg);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .user-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            font-weight: 700;
            color: var(--text);
            font-size: 16px;
        }

        .logout-btn {
            padding: 8px 16px;
            background: var(--bg);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            color: var(--muted);
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: var(--accent);
            color: white;
        }

        .new-chat-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .new-chat-btn:hover {
            transform: translateY(-2px);
        }

        .chat-sessions {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
        }

        .chat-session {
            padding: 12px;
            margin-bottom: 8px;
            background: var(--bg);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .chat-session:hover {
            background: var(--accent);
            color: white;
        }

        .chat-session.active {
            background: var(--accent);
            color: white;
        }

        .session-title {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .session-date {
            font-size: 12px;
            opacity: 0.7;
        }

        .chat-main {
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            height: calc(100vh - 280px);
        }

        .chat-header {
            padding: 20px 24px;
            border-bottom: 2px solid var(--bg);
        }

        .chat-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .message {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .message.assistant {
            flex-direction: row;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
        }

        .message.assistant .message-avatar {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
        }

        .message-content {
            flex: 1;
            max-width: 70%;
        }

        .message.user .message-content {
            text-align: right;
        }

        .message-text {
            background: var(--bg);
            padding: 12px 16px;
            border-radius: 12px;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .message.user .message-text {
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            color: white;
        }

        .message-time {
            font-size: 12px;
            color: var(--muted);
            margin-top: 4px;
            padding: 0 4px;
        }

        .chat-input-container {
            padding: 20px 24px;
            border-top: 2px solid var(--bg);
        }

        .chat-form {
            display: flex;
            gap: 12px;
        }

        .chat-input {
            flex: 1;
            padding: 14px 20px;
            border: 2px solid var(--card);
            border-radius: 24px;
            font-size: 14px;
            resize: none;
            font-family: inherit;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .send-btn {
            padding: 14px 32px;
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            color: white;
            border: none;
            border-radius: 24px;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .send-btn:hover {
            transform: scale(1.05);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .loading-indicator {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .loading-indicator .message-avatar {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
        }

        .loading-dots {
            background: var(--bg);
            padding: 12px 16px;
            border-radius: 12px;
            display: flex;
            gap: 6px;
        }

        .loading-dot {
            width: 8px;
            height: 8px;
            background: var(--muted);
            border-radius: 50%;
            animation: loadingDot 1.4s infinite;
        }

        .loading-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .loading-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes loadingDot {

            0%,
            60%,
            100% {
                transform: translateY(0);
                opacity: 0.5;
            }

            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            .chat-layout {
                grid-template-columns: 1fr;
            }

            .chat-sidebar {
                height: auto;
                position: static;
            }

            .message-content {
                max-width: 85%;
            }
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <span class="logo-icon">üç≥</span>
                <span class="logo-text">Kitchen Exchange</span>
            </a>
            <ul class="nav-menu">
                <li><a href="index.html">Accueil</a></li>
                <li><a href="recipes.html">Recettes</a></li>
                <li><a href="posts.html">Publications</a></li>
                <li><a href="chatbot.html" class="active">Assistant</a></li>
                <li><a href="admin.html">Admin</a></li>
            </ul>
            <div class="nav-actions">
                <a href="auth.html" class="btn-ghost">Connexion</a>
                <a href="add-recipe.html" class="btn-primary">Ajouter une recette</a>
            </div>
        </div>
    </nav>

    <div class="chat-layout">
        <!-- Sidebar -->
        <div class="chat-sidebar">
            <div class="sidebar-header">
                <div class="user-info">
                    <div class="user-avatar">üë§</div>
                    <div class="user-details">
                        <div class="user-name" id="userName">Utilisateur</div>
                        <button class="logout-btn" onclick="logout()">D√©connexion</button>
                    </div>
                </div>
                <button class="new-chat-btn" onclick="createNewChat()">
                    ‚ûï Nouvelle conversation
                </button>
            </div>
            <div class="chat-sessions" id="chatSessionsList">
                <div style="text-align: center; padding: 40px 20px; color: var(--muted);">
                    Chargement...
                </div>
            </div>
        </div>

        <!-- Main Chat -->
        <div class="chat-main">
            <div class="chat-header">
                <h1 class="chat-title">ü§ñ Assistant Culinaire</h1>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div style="text-align: center; padding: 80px 20px; color: var(--muted);">
                    <div style="font-size: 64px; margin-bottom: 16px;">üí¨</div>
                    <h3>Bienvenue sur l'Assistant Culinaire</h3>
                    <p>Posez-moi des questions sur les recettes, les ingr√©dients ou la cuisine !</p>
                    <p style="font-size: 14px; margin-top: 16px;">Cr√©ez une nouvelle conversation ou s√©lectionnez-en une
                        existante.</p>
                </div>
            </div>

            <div class="chat-input-container">
                <form class="chat-form" id="chatForm">
                    <textarea id="messageInput" class="chat-input" placeholder="Posez votre question..." rows="1"
                        required></textarea>
                    <button type="submit" class="send-btn" id="sendBtn">Envoyer</button>
                </form>

                <!-- Voice Recorder Section -->
                <div class="voice-recorder-section"
                    style="margin-top: 12px; padding: 16px; background: var(--card); border-radius: var(--radius); display: none;"
                    id="voiceRecorderSection">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                        <h4 style="margin: 0; font-size: 14px; color: var(--accent);">üé§ Message vocal</h4>
                        <button type="button" class="btn-ghost" style="padding: 4px 12px; font-size: 12px;"
                            onclick="toggleVoiceRecorder()">Fermer</button>
                    </div>
                    <div class="recorder-controls"
                        style="display: flex; gap: 10px; align-items: center; margin-bottom: 12px;">
                        <canvas class="visualizer" width="400" height="60"
                            style="flex: 1; background: var(--bg); border-radius: 8px;"></canvas>
                        <div style="display: flex; gap: 8px;">
                            <button type="button" class="record btn-primary"
                                style="padding: 8px 16px; white-space: nowrap;">üî¥ Enregistrer</button>
                            <button type="button" class="stop btn-ghost" style="padding: 8px 16px;" disabled>‚èπÔ∏è
                                Arr√™ter</button>
                        </div>
                    </div>
                    <div class="sound-clips" aria-live="polite"
                        style="display: flex; flex-direction: column; gap: 8px;">
                        <!-- Voice recordings will appear here -->
                    </div>
                </div>

                <!-- Toggle Voice Recorder Button -->
                <button type="button" class="btn-ghost" style="margin-top: 8px; width: 100%; padding: 8px;"
                    onclick="toggleVoiceRecorder()">
                    üé§ Envoyer un message vocal
                </button>
            </div>
        </div>
    </div>

    <script src="js/nav.js"></script>
    <script type="module" src="js/chat.js"></script>
</body>

</html>